<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/styleIndex.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="img/favicon.png">
    <title>Chi Siamo - equo compenso</title>
</head>
<body>

    <header>

        <section class="header-img">
            <img src="img/logo2.png" alt="logo">
        </section>

        <div class="ls">
            <ul>
                <li><a href="index.html">home</a></li>
                <li><a href="chi-siamo.html">chi siamo</a></li>
                <li><a href="calcola.html">calcola</a></li>
                <li><a href="norme.html">norme</a></li>
                <li><button onclick="window.location.href='index.html?login=1'">login</button></li>
                <li><button onclick="window.location.href='index.html?register=1'">registrati</button></li>
            </ul>
        </div>

    </header>
    
    <main>

        <div class="container">
            <div class="hero">
                <h2>Chi Siamo</h2>
                <p>Scopri la nostra storia e la missione che ci guida.</p>
                
            </div>
        </div>

        <div class="section-divider"></div>

        <div class="cointener">
            <div class="norme-content">
                <section class="card-norme">
                    <h2>La Mission: L'Era dell'Equo Compenso</h2>
                    <div class="divider"></div>
                    <p>Nasce dall'esigenza di fornire ai professionisti e alle imprese uno strumento di precisione per la determinazione dei compensi professionali, garantendo la piena conformità alla Legge 21 aprile 2023 n. 49. In un mercato complesso, la nostra missione è assicurare che ogni prestazione sia commisurata al valore, al pregio dell'opera e alla dignità professionale.</p>
                </section>

                <section class="card-norme">
                    <h2>Cosa Facciamo: Tecnologia al servizio del D.M. 140/2012</h2>
                    <div class="divider"></div>
                    <ul>
                        <li><strong>Precisione Normativa</strong>: traduciamo la complessità del D.M. 140/2012 in algoritmi immediati, coprendo le attività dei Dottori Commercialisti: dalla tenuta contabilità (Art. 23) alle operazioni straordinarie (Art. 25) fino alla rappresentanza tributaria (Art. 28).</li>
                        <li><strong>Trasparenza Totale</strong>: ogni calcolo genera un report PDF analitico che esplicita la metodologia utilizzata, gli scaglioni applicati e i riferimenti ai riquadri della Tabella C.</li>
                        <li><strong>Supporto all'Equo Compenso</strong>: aiutiamo i professionisti a tutelarsi nei rapporti con i “contraenti forti” (banche, assicurazioni, grandi imprese e PA), dove l'applicazione dei parametri ministeriali è diventata un obbligo di legge.</li>
                    </ul>
                </section>

                <section class="card-norme chi-siamo-values">
                    <h2>I Nostri Valori (I Pilastri del Progetto)</h2>
                    <div class="divider"></div>
                    <p class="chi-siamo-values-intro">I principi che guidano lo sviluppo della piattaforma e l'affidabilità dei risultati.</p>
                    <div class="chi-siamo-values-grid">
                        <div class="chi-siamo-values-item">
                            <h3 class="chi-siamo-values-title">Autorevolezza</h3>
                            <p>Ogni parametro è estratto direttamente dai riquadri ministeriali ufficiali.</p>
                        </div>
                        <div class="chi-siamo-values-item">
                            <h3 class="chi-siamo-values-title">Identità</h3>
                            <p>Un'area riservata personalizzata dove il professionista può gestire i propri dati e monitorare i calcoli effettuati.</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>

    </main>
    
    <footer>
        <div class="footer-content">
            <p>&copy; 2025 equocompenso. All rights reserved.</p>
        </div>
    </footer>

    <script>
        function parseJwt(token) {
            if (!token || typeof token !== 'string') return {};
            const parts = token.split('.');
            if (parts.length !== 3) return {};
            try {
                return JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
            } catch {
                return {};
            }
        }

        async function updateHeaderUser() {
            const token = localStorage.getItem('authToken');
            const user = parseJwt(token);
            const headerUl = document.querySelector('.ls ul');
            if (!headerUl) return;
            const isLogged = !!token && (!!user.sub || !!user.id || !!user.email);

            function initialsFrom(u) {
                const nome = (u && u.nome ? String(u.nome) : '').trim();
                const cognome = (u && u.cognome ? String(u.cognome) : '').trim();
                if (nome || cognome) {
                    return `${nome.charAt(0)}${cognome.charAt(0)}`.toUpperCase();
                }
                const email = (u && u.email ? String(u.email) : '').trim();
                if (email) return email.charAt(0).toUpperCase();
                return 'U';
            }

            async function syncNavAvatar() {
                const img = document.getElementById('nav-user-photo');
                const initials = document.querySelector('.nav-user-initials');
                if (!img || !initials) return;

                let u = user || {};
                try {
                    const me = await fetch('/api/me', {
                        method: 'GET',
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    if (me.ok) {
                        const data = await me.json();
                        if (data && data.user) u = data.user;
                    }
                } catch {
                    u = user || {};
                }

                const avatarUrl = u && u.avatar_url ? String(u.avatar_url) : '';
                if (avatarUrl) {
                    const normalized = (/^https?:\/\//i.test(avatarUrl) || avatarUrl.startsWith('/'))
                        ? avatarUrl
                        : `/${avatarUrl}`;
                    img.onerror = () => {
                        img.removeAttribute('src');
                        img.style.display = 'none';
                        initials.textContent = initialsFrom(u);
                        initials.style.display = '';
                    };
                    img.src = normalized;
                    img.style.display = '';
                    initials.style.display = 'none';
                } else {
                    img.removeAttribute('src');
                    img.style.display = 'none';
                    initials.textContent = initialsFrom(u);
                    initials.style.display = '';
                }
            }

            function isAuthLi(li) {
                const txt = (li.textContent || '').trim().toLowerCase();
                if (txt === 'login' || txt === 'registrati') return true;
                const btn = li.querySelector('button');
                if (btn && btn.onclick) {
                    const fn = btn.onclick.toString();
                    if (fn.includes('login') || fn.includes('openRegisterModal') || fn.includes('register')) return true;
                }
                const a = li.querySelector('a');
                if (a) {
                    const href = (a.getAttribute('href') || '').toLowerCase();
                    if (href.includes('login') || href.includes('register')) return true;
                }
                return false;
            }

            if (isLogged) {
                headerUl.querySelectorAll('li').forEach(li => {
                    if (isAuthLi(li)) li.style.display = 'none';
                });
                if (!headerUl.querySelector('.user-item')) {
                    const userLi = document.createElement('li');
                    userLi.className = 'user-item';
                    userLi.innerHTML = `
                        <div class="user-dropdown">
                            <button class="user-btn" onclick="toggleUserDropdown(event)">
                                <span class="user-avatar"><img id="nav-user-photo" class="nav-user-photo" alt="Foto profilo"><span class="nav-user-initials"></span></span>
                                <span class="user-welcome-text">Ciao, ${user.nome || user.email || ''}</span>
                            </button>
                            <div id="userDropdownMenu" class="user-dropdown-menu">
                                <div class="user-menu-info">
                                    <div class="user-menu-avatar-lg"><i class="fas fa-user"></i></div>
                                    <div>
                                        <div class="user-menu-name">${(user.nome || '').trim() ? `Ciao, ${user.nome}` : 'Account'}</div>
                                        <div class="user-menu-email">${user.email || ''}</div>
                                    </div>
                                </div>
                                <div class="user-menu-items">
                                    <button class="user-menu-item" onclick="window.location.href='dashboard.html?view=profile'"><i class="fas fa-user"></i><span>Il mio Profilo</span></button>
                                    <button class="user-menu-item" onclick="window.location.href='dashboard.html?view=calculations'"><i class="fas fa-history"></i><span>I miei Calcoli</span></button>
                                    <button class="user-menu-item" onclick="window.location.href='dashboard.html?view=security'"><i class="fas fa-gear"></i><span>Impostazioni</span></button>
                                </div>
                                <div class="user-menu-footer">
                                    <button class="user-menu-item danger" onclick="handleLogout()"><i class="fas fa-right-from-bracket"></i><span>Esci / Logout</span></button>
                                </div>
                            </div>
                        </div>
                    `;
                    headerUl.appendChild(userLi);
                }
                await syncNavAvatar();
            } else {
                headerUl.querySelectorAll('li').forEach(li => {
                    if (isAuthLi(li)) li.style.display = '';
                });
                const userLi = headerUl.querySelector('.user-item');
                if (userLi) userLi.remove();
            }
        }

        function toggleUserDropdown(event) {
            if (event) event.stopPropagation();
            const menu = document.getElementById('userDropdownMenu');
            if (!menu) return;
            menu.classList.toggle('open');
        }

        function handleLogout() {
            localStorage.removeItem('authToken');
            updateHeaderUser();
            window.location.href = 'index.html';
        }

        function openProfileModal() {
            window.location.href = 'index.html?profile=1';
        }

        document.addEventListener('click', function(event) {
            if (!event.target.closest('.user-dropdown')) {
                const menu = document.getElementById('userDropdownMenu');
                if (menu) menu.classList.remove('open');
            }
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const menu = document.getElementById('userDropdownMenu');
                if (menu) menu.classList.remove('open');
            }
        });

        (function() {
            updateHeaderUser();
        })();
    </script>

</body>
</html>
